{% extends "base.html" %}
{% load i18n %}
{% block content %}
<div>
    {% if user.is_authenticated %}
    <a href="{% url "new_post" %}">
        <button>{% trans '–ù–æ–≤—ã–π –ø–æ—Å—Ç' %}</button>
    </a>
    {% endif %}
    {% for post in posts %}
    
        <div class="post">
            <div class="post-header">
                <div class="avatar-circle">
                    {{ post.author.username|first|upper }}
                </div>
                <h1>{{post.author.username}}</h1>
            </div>
            {% if post.att %}
                <div class = "post_img">
                    <img src="{{ post.att.0.file.url }}" width="250px">
                </div>
            {% endif %}
            <div class="post_content">
                <a href="{% url 'post_details' pid=post.pk %}">
                    <h1>{{post.title}}</h1>
                </a>
                <p>{{post.content}}</p>
                <p>{{post.time_stamp}}</p>
                {% if post.edited %}
                    <p>{% trans '–ò–∑–º–µ–Ω–µ–Ω–æ' %}</p>
                {% endif %}
                {% if user.is_authenticated %}
                 <form method="post" action="{% url 'post_list' %}">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="likes">
                    <input type="hidden" name="post_id" value="{{post.pk}}">
                    
                    <button type="submit">
                        {% if user in post.likes.all %}
                            ‚ù§Ô∏è {{post.likes.count}}
                        {% else %}
                            üíî {{post.likes.count}}
                        {% endif %}
                    </button>
                </form>
                {% endif %}
            </div>
            {% if user.is_authenticated and user == post.author or user.is_staff or user.is_superuser %}
            <a href="{% url "edit_post" pid=post.pk %}">
                <button>{% trans '–ò–∑–º–µ–Ω–∏—Ç—å –ø–æ—Å—Ç' %}</button>
            </a>
            <a href="{% url "delete_post" pid=post.pk %}">
                <button>{% trans '–£–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç' %}</button>
            </a>
            {% endif %}
            {% if user.is_authenticated %}
            <form method="post" action="{% url 'post_list' %}" class="add-comment">
                {% csrf_token %}
                <input type="hidden" name="action" value="comment">
                <input type="hidden" name="post_id" value="{{post.pk}}">
                <Textarea name="content" placeholder="{% trans '–í–∞—à –∫–æ–º–º–µ—Ç–∞—Ä–∏–π...' %}"></Textarea>
                <button type="submit">{% trans '–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å' %}</button>
            </form>
            {% endif %}
            <div >
                {% if post.comments_pin %}
                    {% for comment in post.comments_pin %}
                        <div style="border-top: 1px gray solid">
                            <p>{{comment.author.username}} {{comment.time_stamp}} ({% trans '–ó–∞–∫—Ä–µ–ø–ª–µ–Ω' %})</p>
                            <h3>{{comment.content}}</h3>
                        </div>
                    {% endfor %}
                {% endif %}
                {% for comment in post.comments_reg %}
                    <div style="border-top: 1px gray solid">
                        <p>{{comment.author.username}} {{comment.time_stamp}}</p>
                        <h3>{{comment.content}}</h3>
                    </div>
                {% endfor %}
            </div>

        </div>
    {% endfor %}
</div>
{% endblock %}